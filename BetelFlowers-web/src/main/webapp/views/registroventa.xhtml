<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./betel/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="content">
        <h:form id="fventa">
            <p:wizard flowListener="#{registroVentaBean.onFlowProcess}" showStepStatus="true"
                      nextLabel="Siguiente" backLabel="Atras" showNavBar="true">
                <p:tab id="clientes" title="Clientes">
                    <p:panel header="Seleccione Cliente y/o Sub-Cliente">
                        <h:panelGrid style="margin: 0 auto;">
                            <p:dataTable id="dtCli" value="#{registroVentaBean.clientes}"
                                         filteredValue="#{registroVentaBean.filteredClientes}"
                                         var="cli" rows="5" paginator="true"
                                         paginatorPosition="Bottom" selectionMode="single"
                                         selection="#{registroVentaBean.selectedCliente}"
                                         rowKey="#{cli.codigo}">
                                <p:ajax event="rowSelect" listener="#{registroVentaBean.onRowSelect}" 
                                        update=":fventa:dtSubCli, :fventa:cliSelect"/>
                                <f:facet name="header">
                                    <h:outputText value="Clientes"/>
                                </f:facet>
                                <p:column headerText="Fecha" style="text-align: center">
                                    <h:outputText value="#{cli.lastChange}">
                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss a" timeZone="#{calendarioBean.calenadario.timeZone}"/>
                                    </h:outputText>
                                </p:column>
                                <p:column filterBy="#{cli.codigo}" headerText="Codigo" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{cli.codigo}"/>
                                </p:column>
                                <p:column filterBy="#{cli.empresa}" headerText="Empresa" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{cli.empresa}"/>
                                </p:column>
                                <p:column filterBy="#{cli.nombreContacto}" headerText="Nombre de Contacto" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{cli.nombreContacto}"/>
                                </p:column>
                                <p:column filterBy="#{cli.ruc}" headerText="Cedula/RUC/Pasaporte" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{cli.ruc}"/>
                                </p:column>
                                <p:column headerText="Tipo" style="text-align: center">
                                    <h:outputText value="Comercializadora" rendered="#{cli.comercializadora}"/>
                                    <h:outputText value="Local" rendered="#{cli.local}"/>
                                    <h:outputText value="Exterior" rendered="#{cli.exterior}"/>
                                </p:column>
                            </p:dataTable>
                            <p:dataTable id="dtSubCli" var="subCliSelect" rows="5"
                                         paginator="true" paginatorPosition="Bottom"
                                         value="#{registroVentaBean.subClientes}"
                                         filteredValue="#{registroVentaBean.filteredSubClientes}"
                                         selectionMode="single"
                                         selection="#{registroVentaBean.selectedSubCliente}"
                                         rowKey="#{subCliSelect.codigo}">
                                <p:ajax event="rowSelect" listener="#{registroVentaBean.onRowSelectSubCliente}"
                                        update=":fventa:subCliSelect"/>
                                <f:facet name="header">
                                    <h:outputText value="Sub-Clientes"/>
                                </f:facet>
                                <p:column headerText="Fecha" style="text-align: center">
                                    <h:outputText value="#{subCliSelect.lastChange}">
                                        <f:convertDateTime pattern="dd/MM/yyy HH:mm:ss a" timeZone="#{calendarioBean.calenadario.timeZone}"/>
                                    </h:outputText>
                                </p:column>
                                <p:column filterBy="#{subCliSelect.codigo}" headerText="Codigo" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{subCliSelect.codigo}"/>
                                </p:column>
                                <p:column filterBy="#{subCliSelect.empresa}" headerText="Empresa" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{subCliSelect.empresa}"/>
                                </p:column>
                                <p:column filterBy="#{subCliSelect.nombreContacto}" headerText="Nombre de Contacto" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{subCliSelect.nombreContacto}"/>
                                </p:column>
                            </p:dataTable>
                        </h:panelGrid>
                        <h:panelGrid columns="3" cellpadding="5">
                            <p:outputLabel for="cliSelect" value="Cliente:"/>
                            <p:inputText id="cliSelect" required="true" value="#{registroVentaBean.nuevo.cliente.empresa}"/>
                            <p:message for="cliSelect" display="tooltip" severity="error"/>

                            <p:outputLabel for="subCliSelect" value="Sub-Cliente:"/>
                            <p:inputText id="subCliSelect" value="#{registroVentaBean.nuevo.subCliente.empresa}"/>
                            <p:message for="subCliSelect" display="tooltip" severity="error"/>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="destinos" title="Destino">
                    <p:panel header="Seleccione los Puertos y complete la informacion">
                        <h:panelGrid>
                            <p:outputLabel value="Puerto de Embarque"/>
                            <h:panelGrid columns="6" cellpadding="5">
                                <p:outputLabel for="pEmb" value="Pais:"/>
                                <p:selectOneMenu id="pEmb" required="true" 
                                                 value="#{registroVentaBean.nuevo.puertoEmbarque.pais.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{paisBean.paices}" var="pass"
                                                   itemLabel="#{pass.nombre}" itemValue="#{pass.codigo}"/>
                                    <p:ajax update=":fventa:cEmb" listener="#{registroVentaBean.chancePaisOrigen}"/>
                                </p:selectOneMenu>
                                <p:message for="pEmb" display="tooltip" severity="error"/>

                                <p:outputLabel for="cEmb" value="Ciudad:"/>
                                <p:selectOneMenu id="cEmb" required="true" 
                                                 value="#{registroVentaBean.nuevo.puertoEmbarque.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{registroVentaBean.origen}" var="ciud"
                                                   itemLabel="#{ciud.nombre}" itemValue="#{ciud.codigo}"/>
                                </p:selectOneMenu>
                                <p:message for="cEmb" display="tooltip" severity="error"/>
                            </h:panelGrid>
                            <p:outputLabel value="Puerto de Destino"/>
                            <h:panelGrid columns="6" cellpadding="5">
                                <p:outputLabel for="pDes" value="Pais:"/>
                                <p:selectOneMenu id="pDes" required="true" 
                                                 value="#{registroVentaBean.nuevo.puertoDestino.pais.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{paisBean.paices}" var="passd"
                                                   itemLabel="#{passd.nombre}" itemValue="#{passd.codigo}"/>
                                    <p:ajax update=":fventa:dae, :fventa:cDes" listener="#{registroVentaBean.findDaeByPaisDestino}"/>
                                </p:selectOneMenu>
                                <p:message for="pDes" display="tooltip" severity="error"/>

                                <p:outputLabel for="cDes" value="Ciudad:"/>
                                <p:selectOneMenu id="cDes" required="true" 
                                                 value="#{registroVentaBean.nuevo.puertoDestino.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{registroVentaBean.destino}" var="ciud"
                                                   itemLabel="#{ciud.nombre}" itemValue="#{ciud.codigo}"/>
                                </p:selectOneMenu>
                                <p:message for="cDes" display="tooltip" severity="error"/>
                            </h:panelGrid>
                            <h:panelGrid columns="3" cellpadding="5">
                                <p:outputLabel for="dae" value="DAE:"/>
                                <p:inputText id="dae" required="true" value="#{registroVentaBean.nuevo.dae.codigoDAE}"/>
                                <p:message for="dae" display="tooltip" severity="error"/>
                            </h:panelGrid>
                            <h:panelGrid columns="6" cellpadding="5">
                                <p:outputLabel for="terExp" value="Terminos de Exportacion:"/>
                                <p:selectOneMenu id="terExp" required="true" 
                                                 value="#{registroVentaBean.nuevo.termino.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{terminoExportacionBean.terminos}" var="ter"
                                                   itemLabel="#{ter.descripcion}" itemValue="#{ter.codigo}"/>
                                    <p:ajax update=":fventa:valTerExp" listener="#{registroVentaBean.findTerminoExportacion}"/>
                                </p:selectOneMenu>
                                <p:message for="terExp" display="tooltip" severity="error"/>

                                <p:outputLabel for="valTerExp" value="Valor:"/>
                                <p:inputText id="valTerExp" required="true" value="#{registroVentaBean.nuevo.termino.valor}"/>
                                <p:message for="valTerExp" display="tooltip" severity="error"/>
                            </h:panelGrid>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="agencias" title="Agencia de Carga">
                    <p:panel header="Seleccione la Agencia de Carga y complete la informacion">
                        <h:panelGrid columns="6" cellpadding="5">
                            <p:outputLabel for="ageC" value="Agencia de Carga"/>
                            <p:selectOneMenu id="ageC" required="true" 
                                             value="#{registroVentaBean.nuevo.agenciaCarga.codigo}">
                                <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{cargueraBean.cargueras}" var="acarg"
                                               itemLabel="#{acarg.nombre}" itemValue="#{acarg.codigo}"/>
                                <p:ajax update=":fventa:cfrio" listener="#{registroVentaBean.changeAgenciaCarga}"/>
                            </p:selectOneMenu>
                            <p:message for="ageC" display="tooltip" severity="error"/>

                            <p:outputLabel for="cfrio" value="Cuarto Frio:"/>
                            <p:selectOneMenu id="cfrio" required="true" 
                                             value="#{registroVentaBean.nuevo.cuartoFrio.codigo}">
                                <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{registroVentaBean.frios}" var="cfrios"
                                               itemLabel="#{cfrios.descripcion}" itemValue="#{cfrios.codigo}"/>
                            </p:selectOneMenu>
                            <p:message for="cfrio" display="tooltip" severity="error"/>
                        </h:panelGrid>
                        <h:panelGrid columns="6" cellpadding="5">
                            <p:outputLabel for="awb" value="AWB:" />
                            <p:inputMask id="awb" required="true" value="#{registroVentaBean.nuevo.AWB}" mask="999-99999999"/>
                            <p:message for="awb" display="tooltip" severity="error"/>

                            <p:outputLabel for="hawb" value="HAWB:" />
                            <p:inputText id="hawb" required="true" value="#{registroVentaBean.nuevo.HAWB}"/>
                            <p:message for="hawb" display="tooltip" severity="error"/>
                        </h:panelGrid>
                        <h:panelGrid cellpadding="5">
                            <p:outputLabel for="obser" value="Observacion:" />
                            <p:inputTextarea id="obser" cols="70" rows="5"  
                                             value="#{registroVentaBean.nuevo.observacion}"/>
                            <p:message for="obser" display="tooltip" severity="error"/>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="detalles" title="Detalle de Venta">
                    <p:panel header="Agrege veriedades para el detalle">
                        <h:panelGrid columns="10" cellpadding="5">
                            <p:outputLabel for="mumCja" value="Cantidad Cajas:"/>
                            <p:spinner id="mumCja" value="#{registroVentaBean.detalleVenta.nuevo.cantidadCajas}"
                                       min="0" />
                            <p:message for="mumCja" display="tooltip" severity="error"/>

                            <p:outputLabel for="tipCja" value="Tipo Caja"/>
                            <p:selectOneMenu id="tipCja" rendered="true" 
                                             value="#{registroVentaBean.detalleVenta.nuevo.cajaTipo.codigo}">
                                <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{tipoCajaBean.tipoCajas}" var="tcja"
                                               itemLabel="#{tcja.tipo}" itemValue="#{tcja.codigo}"/>
                            </p:selectOneMenu>
                            <p:message for="tipCja" display="tooltip" severity="error"/>

                            <p:outputLabel for="mCja" value="Marca Caja"/>
                            <p:selectOneMenu id="mCja" 
                                             value="#{registroVentaBean.detalleVenta.nuevo.marcaCaja.codigo}">
                                <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{registroVentaBean.nuevo.cliente.cajas}" var="mrCja"
                                               itemLabel="#{mrCja.nombre}" itemValue="#{mrCja.codigo}"/>
                            </p:selectOneMenu>
                            <p:message for="mCja" display="tooltip" severity="error"/>
                        </h:panelGrid>
                        <p:separator/>
                        <p:outputPanel id="outVari">
                            <h:panelGrid columns="6" cellpadding="5">
                                <p:outputLabel for="bod" value="Bodega:"/>
                                <p:selectOneMenu id="bod"  value="#{registroVentaBean.findStocksExportacion.bodega.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{bodegaBean.bodegas}" var="bodRV"
                                                   itemLabel="#{bodRV.nombre}" itemValue="#{bodRV.codigo}"/>
                                </p:selectOneMenu>
                                <p:message for="bod" display="tooltip" severity="error"/>

                                <p:outputLabel for="variedad" value="Variedad:"/>
                                <p:selectOneMenu id="variedad" 
                                                 value="#{registroVentaBean.findStocksExportacion.variedad.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{variedadBean.variedades}" var="va" itemLabel="#{va.nombre}"
                                                   itemValue="#{va.codigo}"/>
                                    <p:ajax listener="#{registroVentaBean.loadVariedad}" 
                                            update=":fventa:outDetVari, :fventa:outPrice" />
                                </p:selectOneMenu>
                                <p:message for="variedad" display="tooltip" severity="error"/>
                            </h:panelGrid>
                        </p:outputPanel>
                        <p:outputPanel id="outDetVari">
                            <h:panelGrid columns="6" cellpadding="5">
                                <p:outputLabel for="longitud" value="Longitud:" 
                                               rendered="#{not registroVentaBean.findStocksExportacion.variedad.girasol}"/>

                                <p:selectOneMenu id="longitud" value="#{registroVentaBean.findStocksExportacion.longitud}"
                                                 rendered="#{not registroVentaBean.findStocksExportacion.variedad.girasol}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{registroVentaBean.findStocksExportacion.variedad.longitudes}"
                                                   var="mxlo" itemLabel="#{mxlo}" itemValue="#{mxlo}"/>
                                    <p:ajax update=":fventa:outPrice" 
                                            listener="#{registroVentaBean.loadPrcioUnitVariedadLongitud}"/>
                                </p:selectOneMenu>
                                <p:message for="longitud" display="tooltip" severity="error"
                                           rendered="#{not registroVentaBean.findStocksExportacion.variedad.girasol}"/>

                                <p:outputLabel for="glongitud" value="Longitud:" 
                                               rendered="#{registroVentaBean.findStocksExportacion.variedad.girasol}"/>

                                <p:selectOneMenu id="glongitud" value="#{registroVentaBean.findStocksExportacion.glongitud}"
                                                 rendered="#{registroVentaBean.findStocksExportacion.variedad.girasol}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{registroVentaBean.findStocksExportacion.variedad.glongitudes}"
                                                   var="mxglo" itemLabel="#{mxglo}" itemValue="#{mxglo}"/>
                                    <p:ajax update=":fventa:outPrice" 
                                            listener="#{registroVentaBean.loadPrcioUnitVariedadLongitud}"/>
                                </p:selectOneMenu>
                                <p:message for="glongitud" display="tooltip" severity="error"
                                           rendered="#{registroVentaBean.findStocksExportacion.variedad.girasol}"/>

                                <p:outputLabel for="puntoCorte" value="Punto de Corte:"/>
                                <p:selectOneMenu id="puntoCorte" value="#{registroVentaBean.findStocksExportacion.puntoCorte}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{registroVentaBean.findStocksExportacion.variedad.puntosCorte}"
                                                   var="ptc" itemLabel="#{ptc}" itemValue="#{ptc}"/>
                                </p:selectOneMenu>
                                <p:message for="puntoCorte" display="tooltip" severity="error"/>
                            </h:panelGrid>
                        </p:outputPanel>
                        <h:panelGrid cellpadding="5">
                            <p:commandButton value="Buscar" 
                                             update=":fventa:outItems, :fventa:outPrice"
                                             actionListener="#{registroVentaBean.findDisponibilidadStock(evt)}"/>
                        </h:panelGrid>
                        <p:separator/>
                        <p:outputPanel id="outPrice">
                            <h:panelGrid cellpadding="5">
                                <p:outputLabel for="mPrecioVari" value="Precio Unit. Tallo por Variedad:"
                                               rendered="#{registroVentaBean.addPriceflowersTallo}"/>
                                <p:inputNumber id="mPrecioVari" value="#{registroVentaBean.priceUnit}"
                                               minValue="0.00" maxValue="100.00" decimalPlaces="2"
                                               rendered="#{registroVentaBean.addPriceflowersTallo}">
                                    <p:ajax event="keyup" update=":fventa:rangePrice, :fventa:outItems" 
                                            listener="#{registroVentaBean.enableAgregarTallos}"/>
                                </p:inputNumber>
                                <p:outputLabel id="rangePrice" rendered="#{registroVentaBean.addPriceflowersTallo}"
                                               value="Por favor ingrese un valor en el rango, Valor Minimo: #{registroVentaBean.priceMin}, Valor Maximo: #{registroVentaBean.priceMax}"/>
                            </h:panelGrid>
                        </p:outputPanel>
                        <p:panel header="Intrucciones" style="align-content: center; text-align: center">
                            <h:outputText value="Para establecer la cantidad de ramos de click sobre la celda correspondiente."/>
                        </p:panel>
                        <p:messages id="messages"  globalOnly="true" showDetail="true" severity="info, error, warning"/>
                        <p:outputPanel id="outItems">
                            <h:panelGrid style="margin: 0 auto;">
                                <p:dataTable id="dtSelectStock" var="itemStockVenta"
                                             paginator="true" tableStyle="width: auto"
                                             paginatorPosition="Bottom" rows="10" 
                                             value="#{registroVentaBean.detalleRegistroSock}" 
                                             selection="#{registroVentaBean.selectDetalleRegistroSock}"
                                             editable="true" editMode="cell" widgetVar="cellVenta"
                                             rowKey="#{itemStockVenta.registro.codigo}" style="margin-bottom:0">
                                    <f:facet name="header">
                                        <h:outputText value="Flor en Bodega"/>
                                    </f:facet>
                                    <p:column selectionMode="multiple" style="width:16px;text-align:center"/>
                                    <p:column style="text-align: center" headerText="Fecha" >
                                        <h:outputText value="#{itemStockVenta.registro.creationDate}">
                                            <f:convertDateTime pattern="dd/MM/yyy HH:mm:ss a" timeZone="#{calendarioBean.calenadario.timeZone}"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column headerText="Barcode" style="text-align: center">
                                        <p:barcode value="#{itemStockVenta.registro.barcode}" 
                                                   type="code39" width="50%" height="50%"/>
                                    </p:column>
                                    <p:column headerText="Foto" style="text-align: center">
                                        <p:graphicImage value="#{itemStockVenta.registro.variedad.urlFoto}"
                                                        width="40px" height="40px"/>
                                    </p:column>
                                    <p:column style="text-align: center" headerText="Variedad" >
                                        <h:outputText value="#{itemStockVenta.registro.variedad.nombre}"/>
                                    </p:column>
                                    <p:column style="text-align: center" headerText="Ramos" >
                                        <h:outputText value="#{itemStockVenta.registro.numeroRamos}"/>
                                    </p:column>
                                    <p:column style="text-align: center" headerText="Tallos" >
                                        <h:outputText value="#{itemStockVenta.registro.numeroTallosRamo}"/>
                                    </p:column>
                                    <p:column style="text-align: center" headerText="Stock Tallos" >
                                        <h:outputText value="#{itemStockVenta.registro.stock}"/>
                                    </p:column>
                                    <p:column headerText="Cantidad Ramos">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{itemStockVenta.numeroRamos}" /></f:facet>
                                            <f:facet name="input"><p:inputNumber id="mNumRamos" required="true" value="#{itemStockVenta.numeroRamos}" 
                                                                                 style="width:100%" label="Cantidad Ramos"
                                                                                 minValue="0" maxValue="#{itemStockVenta.registro.numeroRamos}">
                                                    <p:ajax update="mNumRamos"/>
                                                </p:inputNumber></f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <f:facet name="footer">
                                        <p:commandButton id="btnAddTallos" disabled="#{registroVentaBean.addflowersCaja}" 
                                                         value="Agregar" process="dtSelectStock" 
                                                         update=":fventa:dtSelectStock, :fventa:configCaja, :fventa:messages"
                                                         action="#{registroVentaBean.onClikListenerSelectList()}"/>

                                    </f:facet>
                                </p:dataTable>
                            </h:panelGrid>
                        </p:outputPanel>
                        <h:panelGrid style="margin: 0 auto;">
                            <p:dataTable id="configCaja"  var="itemConfigCaja"
                                         paginator="true" tableStyle="width: auto"
                                         paginatorPosition="Bottom" rows="10"
                                         value="#{registroVentaBean.variedadesCaja}">
                                <f:facet name="header">
                                    <h:outputText value="Variedades en Caja"/>
                                </f:facet>
                                <p:column headerText="Foto" style="text-align: center">
                                    <p:graphicImage value="#{itemConfigCaja.variedad.urlFoto}"
                                                    width="40px" height="40px"/>
                                </p:column>
                                <p:column style="text-align: center" headerText="Variedad" >
                                    <h:outputText value="#{itemConfigCaja.variedad.nombre}"/>
                                </p:column>
                                <p:column style="text-align: center" headerText="Longitud" >
                                    <h:outputText value="#{itemConfigCaja.longitud}" rendered="#{not itemConfigCaja.variedad.girasol}"/>
                                    <h:outputText value="#{itemConfigCaja.glongitud}" rendered="#{itemConfigCaja.variedad.girasol}"/>
                                </p:column>
                                <p:column style="text-align: center" headerText="Ramos" >
                                    <h:outputText value="#{itemConfigCaja.numeroRamos}"/>
                                </p:column>
                                <p:column style="text-align: center" headerText="Precio Unit." >
                                    <h:outputText value="$ #{itemConfigCaja.precioUnit}"/>
                                </p:column>
                                <p:column style="text-align: center" headerText="Punto Corte" >
                                    <h:outputText value="#{itemConfigCaja.puntoCorte}"/>
                                </p:column>
                                <p:column style="text-align: center" headerText="Total Tallos" >
                                    <h:outputText value="#{itemConfigCaja.totalTallos}"/>
                                </p:column>
                                <p:column style="text-align: center" headerText="SubTotal" >
                                    <h:outputText value="$ #{itemConfigCaja.subTotal}">
                                        <f:convertNumber minFractionDigits="2"/>
                                    </h:outputText>
                                </p:column>
                                <p:column style="width:32px;text-align: center">
                                    <p:commandButton update=":fventa:configCaja, :fventa:messages"
                                                     icon="ui-icon-close" title="Eliminar"
                                                     actionListener="#{registroVentaBean.removeItemVariedadCaja(evt, itemConfigCaja)}">
                                    </p:commandButton>
                                </p:column>
                                <f:facet name="footer">
                                    <p:commandButton value="Crear Caja" 
                                                     update=":fventa:configCaja, :fventa:outDetalleFinal, :fventa:messages"
                                                     actionListener="#{registroVentaBean.addCajasToDetalle(evt)}"/>
                                </f:facet>
                            </p:dataTable>
                        </h:panelGrid>
                        <p:outputPanel id="outDetalleFinal">
                            <h:panelGrid style="margin: 0 auto;">
                                <p:dataTable id="dtVentaFinal"  var="itemDetalleVenta"
                                             paginator="true" tableStyle="width: auto"
                                             paginatorPosition="Bottom" rows="10"
                                             value="#{registroVentaBean.detalleVenta.itemsDetalleVenta}">
                                    <f:facet name="header">
                                        <h:outputText value="Detalle de Venta"/>
                                    </f:facet>
                                    <p:column style="width:16px">
                                        <p:rowToggler />
                                    </p:column>
                                    <p:column style="text-align: center" headerText="Cantidad Cajas" >
                                        <h:outputText value="#{itemDetalleVenta.cantidadCajas}"/>
                                    </p:column>
                                    <p:column style="text-align: center" headerText="Tipo Caja" >
                                        <h:outputText value="#{itemDetalleVenta.cajaTipo.tipo}"/>
                                    </p:column>
                                    <p:column style="text-align: center" headerText="Marca Caja" >
                                        <h:outputText value="#{itemDetalleVenta.marcaCaja.nombre}"/>
                                    </p:column>
                                    <p:column style="text-align: center" headerText="SubTotal" >
                                        <h:outputText value="#{itemDetalleVenta.subTotalCaja}"/>
                                    </p:column>                          
                                    <p:rowExpansion>
                                        <p:panel style="align-content: center; text-align: center">
                                            <p:dataTable id="dtSubVentaFinal"  var="itemSubConfigCaja"
                                                         paginator="true" tableStyle="width: auto"
                                                         paginatorPosition="Bottom" rows="10"
                                                         value="#{registroVentaBean.subListCajaVariedades(itemDetalleVenta)}">
                                                <f:facet name="header">
                                                    <h:outputText value="Variedades en Caja"/>
                                                </f:facet>
                                                <p:column headerText="Foto" style="text-align: center">
                                                    <p:graphicImage value="#{itemSubConfigCaja.variedad.urlFoto}"
                                                                    width="40px" height="40px"/>
                                                </p:column>
                                                <p:column style="text-align: center" headerText="Variedad" >
                                                    <h:outputText value="#{itemSubConfigCaja.variedad.nombre}"/>
                                                </p:column>
                                                <p:column style="text-align: center" headerText="Longitud" >
                                                    <h:outputText value="#{itemSubConfigCaja.longitud}" rendered="#{not itemSubConfigCaja.variedad.girasol}"/>
                                                    <h:outputText value="#{itemSubConfigCaja.glongitud}" rendered="#{itemSubConfigCaja.variedad.girasol}"/>
                                                </p:column>
                                                <p:column style="text-align: center" headerText="Ramos" >
                                                    <h:outputText value="#{itemSubConfigCaja.numeroRamos}"/>
                                                </p:column>
                                                <p:column style="text-align: center" headerText="Precio Unit." >
                                                    <h:outputText value="$ #{itemSubConfigCaja.precioUnit}"/>
                                                </p:column>
                                                <p:column style="text-align: center" headerText="Punto Corte" >
                                                    <h:outputText value="#{itemSubConfigCaja.puntoCorte}"/>
                                                </p:column>
                                                <p:column style="text-align: center" headerText="Total Tallos" >
                                                    <h:outputText value="#{itemSubConfigCaja.totalTallos}"/>
                                                </p:column>
                                                <p:column style="text-align: center" headerText="SubTotal" >
                                                    <h:outputText value="$ #{itemSubConfigCaja.subTotal}"/>
                                                </p:column>
                                            </p:dataTable>
                                        </p:panel>
                                    </p:rowExpansion>
                                    <f:facet name="footer">
                                        <p:outputLabel value="SubTotal"/>
                                    </f:facet>
                                </p:dataTable>
                            </h:panelGrid>
                        </p:outputPanel>
                    </p:panel>
                </p:tab>
                <p:tab id="generar" title="Generar Venta">
                    <p:panel>
                        <p:commandButton value="Submit" update=":fventa" process="@this"/>
                    </p:panel>
                </p:tab>
            </p:wizard>
        </h:form>
    </ui:define>

</ui:composition>
