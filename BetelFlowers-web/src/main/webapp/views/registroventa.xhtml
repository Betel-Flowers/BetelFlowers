<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./betel/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <ui:define name="content">
        <h:form id="fventa">
            <p:wizard flowListener="#{registroVentaBean.onFlowProcess}" showStepStatus="true"
                      nextLabel="Siguiente" backLabel="Atras" showNavBar="true">
                <p:tab id="clientes" title="Clientes">
                    <p:panel header="Seleccione Cliente y/o Sub-Cliente">
                        <h:panelGrid style="margin: 0 auto;">
                            <p:dataTable id="dtCli" value="#{registroVentaBean.clientes}"
                                         filteredValue="#{registroVentaBean.filteredClientes}"
                                         var="cli" rows="5" paginator="true"
                                         paginatorPosition="Bottom" selectionMode="single"
                                         selection="#{registroVentaBean.selectedCliente}"
                                         rowKey="#{cli.codigo}">
                                <p:ajax event="rowSelect" listener="#{registroVentaBean.onRowSelect}" 
                                        update=":fventa:dtSubCli, :fventa:cliSelect"/>
                                <f:facet name="header">
                                    <h:outputText value="Clientes"/>
                                </f:facet>
                                <p:column headerText="Fecha" style="text-align: center">
                                    <h:outputText value="#{cli.lastChange}">
                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss a" timeZone="#{calendarioBean.calenadario.timeZone}"/>
                                    </h:outputText>
                                </p:column>
                                <p:column filterBy="#{cli.codigo}" headerText="Codigo" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{cli.codigo}"/>
                                </p:column>
                                <p:column filterBy="#{cli.empresa}" headerText="Empresa" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{cli.empresa}"/>
                                </p:column>
                                <p:column filterBy="#{cli.nombreContacto}" headerText="Nombre de Contacto" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{cli.nombreContacto}"/>
                                </p:column>
                                <p:column filterBy="#{cli.ruc}" headerText="Cedula/RUC/Pasaporte" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{cli.ruc}"/>
                                </p:column>
                                <p:column headerText="Tipo" style="text-align: center">
                                    <h:outputText value="Comercializadora" rendered="#{cli.comercializadora}"/>
                                    <h:outputText value="Local" rendered="#{cli.local}"/>
                                    <h:outputText value="Exterior" rendered="#{cli.exterior}"/>
                                </p:column>
                            </p:dataTable>
                            <p:dataTable id="dtSubCli" var="subCliSelect" rows="5"
                                         paginator="true" paginatorPosition="Bottom"
                                         value="#{registroVentaBean.subClientes}"
                                         filteredValue="#{registroVentaBean.filteredSubClientes}"
                                         selectionMode="single"
                                         selection="#{registroVentaBean.selectedSubCliente}"
                                         rowKey="#{subCliSelect.codigo}">
                                <p:ajax event="rowSelect" listener="#{registroVentaBean.onRowSelectSubCliente}"
                                        update=":fventa:subCliSelect"/>
                                <f:facet name="header">
                                    <h:outputText value="Sub-Clientes"/>
                                </f:facet>
                                <p:column headerText="Fecha" style="text-align: center">
                                    <h:outputText value="#{subCliSelect.lastChange}">
                                        <f:convertDateTime pattern="dd/MM/yyy HH:mm:ss a" timeZone="#{calendarioBean.calenadario.timeZone}"/>
                                    </h:outputText>
                                </p:column>
                                <p:column filterBy="#{subCliSelect.codigo}" headerText="Codigo" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{subCliSelect.codigo}"/>
                                </p:column>
                                <p:column filterBy="#{subCliSelect.empresa}" headerText="Empresa" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{subCliSelect.empresa}"/>
                                </p:column>
                                <p:column filterBy="#{subCliSelect.nombreContacto}" headerText="Nombre de Contacto" filterMatchMode="contains" style="text-align: center">
                                    <h:outputText value="#{subCliSelect.nombreContacto}"/>
                                </p:column>
                            </p:dataTable>
                        </h:panelGrid>
                        <h:panelGrid columns="3" cellpadding="5">
                            <p:outputLabel for="cliSelect" value="Cliente:"/>
                            <p:inputText id="cliSelect" required="true" value="#{registroVentaBean.nuevo.cliente.empresa}"/>
                            <p:message for="cliSelect" display="tooltip" severity="error"/>

                            <p:outputLabel for="subCliSelect" value="Sub-Cliente:"/>
                            <p:inputText id="subCliSelect" value="#{registroVentaBean.nuevo.subCliente.empresa}"/>
                            <p:message for="subCliSelect" display="tooltip" severity="error"/>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="destinos" title="Destino">
                    <p:panel header="Seleccione los Puertos y complete la informacion">
                        <h:panelGrid>
                            <p:outputLabel value="Puerto de Embarque"/>
                            <h:panelGrid columns="6" cellpadding="5">
                                <p:outputLabel for="pEmb" value="Pais:"/>
                                <p:selectOneMenu id="pEmb" required="true" 
                                                 value="#{registroVentaBean.nuevo.puertoEmbarque.pais.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{paisBean.paices}" var="pass"
                                                   itemLabel="#{pass.nombre}" itemValue="#{pass.codigo}"/>
                                    <p:ajax update=":fventa:cEmb" listener="#{registroVentaBean.chancePaisOrigen}"/>
                                </p:selectOneMenu>
                                <p:message for="pEmb" display="tooltip" severity="error"/>

                                <p:outputLabel for="cEmb" value="Ciudad:"/>
                                <p:selectOneMenu id="cEmb" required="true" 
                                                 value="#{registroVentaBean.nuevo.puertoEmbarque.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{registroVentaBean.origen}" var="ciud"
                                                   itemLabel="#{ciud.nombre}" itemValue="#{ciud.codigo}"/>
                                </p:selectOneMenu>
                                <p:message for="cEmb" display="tooltip" severity="error"/>
                            </h:panelGrid>
                            <p:outputLabel value="Puerto de Destino"/>
                            <h:panelGrid columns="6" cellpadding="5">
                                <p:outputLabel for="pDes" value="Pais:"/>
                                <p:selectOneMenu id="pDes" required="true" 
                                                 value="#{registroVentaBean.nuevo.puertoDestino.pais.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{paisBean.paices}" var="passd"
                                                   itemLabel="#{passd.nombre}" itemValue="#{passd.codigo}"/>
                                    <p:ajax update=":fventa:dae, :fventa:cDes" listener="#{registroVentaBean.findDaeByPaisDestino}"/>
                                </p:selectOneMenu>
                                <p:message for="pDes" display="tooltip" severity="error"/>

                                <p:outputLabel for="cDes" value="Ciudad:"/>
                                <p:selectOneMenu id="cDes" required="true" 
                                                 value="#{registroVentaBean.nuevo.puertoDestino.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{registroVentaBean.destino}" var="ciud"
                                                   itemLabel="#{ciud.nombre}" itemValue="#{ciud.codigo}"/>
                                </p:selectOneMenu>
                                <p:message for="cDes" display="tooltip" severity="error"/>
                            </h:panelGrid>
                            <h:panelGrid columns="3" cellpadding="5">
                                <p:outputLabel for="dae" value="DAE:"/>
                                <p:inputText id="dae" required="true" value="#{registroVentaBean.nuevo.dae.codigoDAE}"/>
                                <p:message for="dae" display="tooltip" severity="error"/>
                            </h:panelGrid>
                            <h:panelGrid columns="6" cellpadding="5">
                                <p:outputLabel for="terExp" value="Terminos de Exportacion:"/>
                                <p:selectOneMenu id="terExp" required="true" 
                                                 value="#{registroVentaBean.nuevo.termino.codigo}">
                                    <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                    <f:selectItems value="#{terminoExportacionBean.terminos}" var="ter"
                                                   itemLabel="#{ter.descripcion}" itemValue="#{ter.codigo}"/>
                                    <p:ajax update=":fventa:valTerExp" listener="#{registroVentaBean.findTerminoExportacion}"/>
                                </p:selectOneMenu>
                                <p:message for="terExp" display="tooltip" severity="error"/>

                                <p:outputLabel for="valTerExp" value="Valor:"/>
                                <p:inputText id="valTerExp" required="true" value="#{registroVentaBean.nuevo.termino.valor}"/>
                                <p:message for="valTerExp" display="tooltip" severity="error"/>
                            </h:panelGrid>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="agencias" title="Agencia de Carga">
                    <p:panel header="Seleccione la Agencia de Carga y complete la informacion">
                        <h:panelGrid columns="6" cellpadding="5">
                            <p:outputLabel for="ageC" value="Agencia de Carga"/>
                            <p:selectOneMenu id="ageC" required="true" 
                                             value="#{registroVentaBean.nuevo.agenciaCarga.codigo}">
                                <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{cargueraBean.cargueras}" var="acarg"
                                               itemLabel="#{acarg.nombre}" itemValue="#{acarg.codigo}"/>
                                <p:ajax update=":fventa:cfrio" listener="#{registroVentaBean.changeAgenciaCarga}"/>
                            </p:selectOneMenu>
                            <p:message for="ageC" display="tooltip" severity="error"/>

                            <p:outputLabel for="cfrio" value="Cuarto Frio:"/>
                            <p:selectOneMenu id="cfrio" required="true" 
                                             value="#{registroVentaBean.nuevo.cuartoFrio.codigo}">
                                <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{registroVentaBean.frios}" var="cfrios"
                                               itemLabel="#{cfrios.descripcion}" itemValue="#{cfrios.codigo}"/>
                            </p:selectOneMenu>
                            <p:message for="cfrio" display="tooltip" severity="error"/>
                        </h:panelGrid>
                        <h:panelGrid columns="6" cellpadding="5">
                            <p:outputLabel for="awb" value="AWB:" />
                            <p:inputMask id="awb" required="true" value="#{registroVentaBean.nuevo.AWB}" mask="999-99999999"/>
                            <p:message for="awb" display="tooltip" severity="error"/>

                            <p:outputLabel for="hawb" value="HAWB:" />
                            <p:inputText id="hawb" required="true" value="#{registroVentaBean.nuevo.HAWB}"/>
                            <p:message for="hawb" display="tooltip" severity="error"/>
                        </h:panelGrid>
                        <h:panelGrid cellpadding="5">
                            <p:outputLabel for="obser" value="Observacion:" />
                            <p:inputTextarea id="obser" cols="70" rows="5"  
                                             value="#{registroVentaBean.nuevo.observacion}"/>
                            <p:message for="obser" display="tooltip" severity="error"/>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="detalles" title="Detalle de Venta">
                    <p:panel header="Agrege veriedades para el detalle">
                        <h:panelGrid columns="10" cellpadding="5">
                            <p:outputLabel for="mumCja" value="Cantidad Cajas:"/>
                            <p:spinner id="mumCja" value="#{registroVentaBean.detalleVenta.nuevo.cantidadCaja}"
                                       min="0" required="true"/>
                            <p:message for="mumCja" display="tooltip" severity="error"/>
                            
                            <p:outputLabel for="tipCja" value="Tipo Caja"/>
                            <p:selectOneMenu id="tipCja" rendered="true" 
                                             value="#{registroVentaBean.detalleVenta.nuevo.cajaTipo.codigo}">
                                <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{tipoCajaBean.tipoCajas}" var="tcja"
                                               itemLabel="#{tcja.tipo}" itemValue="#{tcja.codigo}"/>
                            </p:selectOneMenu>
                            <p:message for="tipCja" display="tooltip" severity="error"/>
                            
                            <p:outputLabel for="mCja" value="Marca Caja"/>
                            <p:selectOneMenu id="mCja" required="true"
                                             value="#{registroVentaBean.detalleVenta.nuevo.marcaCaja.codigo}">
                                <f:selectItem itemLabel="Seleccionar" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{registroVentaBean.nuevo.cliente.cajas}" var="mrCja"
                                               itemLabel="#{mrCja.nombre}" itemValue="#{mrCja.codigo}"/>
                            </p:selectOneMenu>
                            <p:message for="mCja" display="tooltip" severity="error"/>
                        </h:panelGrid>
                    </p:panel>
                </p:tab>
                <p:tab id="generar" title="Generar Venta">
                    <p:panel>
                        <p:commandButton value="Submit" update=":fventa" process="@this"/>
                    </p:panel>
                </p:tab>
            </p:wizard>
        </h:form>
    </ui:define>

</ui:composition>
